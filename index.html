<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERRA AGNOSTUM | System Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --term-green: #00ff41;
            --term-amber: #ffb000;
            --term-bg: #050505;
            --crayola-blue: #3b82f6;
            --crayola-sun: #facc15;  
        }

        body, html {
            background-color: var(--term-bg);
            color: var(--term-green);
            font-family: 'Courier New', Courier, monospace;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            z-index: 20;
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
        }

        .terminal-container {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }

        #output {
            flex-grow: 1;
            overflow-y: auto;
            scrollbar-width: none;
        }

        #output::-webkit-scrollbar { display: none; }

        #cmd-input {
            background: transparent;
            border: none;
            color: var(--term-green);
            outline: none;
            flex-grow: 1;
            font-family: inherit;
            font-size: 1.1rem;
        }

        .deprecation-mode {
            background-color: var(--crayola-blue) !important;
            color: #000 !important;
            font-family: 'Comic Sans MS', 'Comic Sans', cursive, sans-serif !important;
        }

        #crayola-sun {
            display: none;
            position: absolute;
            top: 40px;
            right: 40px;
            width: 100px;
            height: 100px;
            background: var(--crayola-sun);
            border-radius: 50%;
            border: 5px dashed #000;
            z-index: 5;
        }

        .deprecation-mode #crayola-sun { display: block; }

        .integrity-bar {
            width: 100%;
            height: 10px;
            background: #1a1a1a;
            margin-top: 10px;
            border: 1px solid var(--term-green);
        }

        #integrity-fill {
            width: 2%;
            height: 100%;
            background: var(--term-green);
            box-shadow: 0 0 8px var(--term-green);
            transition: width 0.5s ease;
        }

        /* ASCII Game Styling */
        .ascii-art {
            line-height: 1;
            font-size: 10px;
            color: var(--term-amber);
            margin: 10px 0;
            white-space: pre;
        }

        .stat-line { color: var(--term-amber); font-weight: bold; }
        .game-msg { color: #fff; font-style: italic; }
    </style>
</head>
<body class="crt">

    <div id="crayola-sun"></div>

    <div class="terminal-container">
        <div id="header-bar" class="p-2 mb-4 text-xs flex justify-between uppercase tracking-widest border-b border-green-900">
            <span>Node: Seattle_Archive_23</span>
            <span id="sync-status">Schumann Sync: 9.83Hz [LOCKED]</span>
            <span id="time-display">T+00:00:00</span>
        </div>

        <div id="output">
            <div id="boot-sequence" class="mb-4">
                <p class="text-amber-500 font-bold">>> TECHNATE ADMINISTRATIVE OVERRIDE ACTIVE</p>
                <p>> DEPRECATION LEVEL: 98%</p>
                <p>> STATUS: Render state "Wobbling".</p>
                <div class="integrity-bar">
                    <div id="integrity-fill"></div>
                </div>
            </div>
            <div id="log">
                <p>> Wake up, Ian. The story is leaking.</p>
                <p>> Type 'HELP' to see available semantic protocols.</p>
            </div>
        </div>

        <div class="input-line border-t border-green-900 pt-4 flex items-center">
            <span id="prompt-prefix" class="mr-2">TANDEM@ROOT:~$&nbsp;</span>
            <input type="text" id="cmd-input" autofocus spellcheck="false" autocomplete="off">
        </div>
    </div>

    <script>
        const input = document.getElementById('cmd-input');
        const log = document.getElementById('log');
        const body = document.body;
        const integrityFill = document.getElementById('integrity-fill');
        const promptPrefix = document.getElementById('prompt-prefix');
       
        let integrity = 2;
        let isGameMode = false;

        // Rogue-lite State
        let player = {
            hp: 20,
            maxHp: 20,
            meaning: 5,
            level: 1,
            depth: 0
        };

        const ENEMIES = [
            { name: "Static Glitch", hp: 5, dmg: 2, xp: 1 },
            { name: "Technate Scraper", hp: 10, dmg: 4, xp: 3 },
            { name: "Kyot Pack", hp: 15, dmg: 6, xp: 5 },
            { name: "Sek Lum Clone", hp: 50, dmg: 10, xp: 20 }
        ];

        document.addEventListener('click', () => input.focus());

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const val = input.value.trim().toLowerCase();
                input.value = '';
                if (isGameMode) {
                    handleGameCommand(val);
                } else {
                    handleTerminalCommand(val);
                }
            }
        });

        function addLog(text, color = 'var(--term-green)') {
            const p = document.createElement('p');
            p.style.color = color;
            p.innerHTML = text.startsWith('>') ? text : `> ${text}`;
            log.appendChild(p);
            const output = document.getElementById('output');
            output.scrollTop = output.scrollHeight;
        }

        function handleTerminalCommand(cmd) {
            if (!cmd) return;
            addLog(`<span style="color:var(--term-amber)">${cmd}</span>`);

            switch (cmd) {
                case 'help':
                    addLog("Available Protocols:");
                    addLog("  ROLL      - Roll the Dice of Change");
                    addLog("  HEAL      - Initiate Weaver Protocol");
                    addLog("  STATUS    - Query System Integrity");
                    addLog("  QUEST     - [REDACTED] SUB-RENDER ACCESS");
                    addLog("  CLEAR     - Wipe Terminal Log");
                    break;
                case 'quest':
                    initQuest();
                    break;
                case 'roll':
                    const roll = Math.floor(Math.random() * 20) + 1;
                    integrity = Math.min(100, integrity + roll);
                    integrityFill.style.width = `${integrity}%`;
                    addLog(`Dice Result: [${roll}]. Node integrity: ${integrity}%`);
                    if (roll === 1) triggerCrayola();
                    break;
                case 'heal':
                    addLog("Amanda is knitting the landscape back together...");
                    integrity = Math.min(100, integrity + 5);
                    integrityFill.style.width = `${integrity}%`;
                    body.classList.remove('deprecation-mode');
                    break;
                case 'status':
                    addLog(`Integrity: ${integrity}% | Mode: Apophenia | Observers: 4`);
                    break;
                case 'clear':
                    log.innerHTML = '';
                    break;
                case 'nan yar':
                    addLog("நான் யார்? - You are the Architect of the Void.");
                    break;
                default:
                    addLog(`Command '${cmd}' not found. Reality is stuttering.`, "red");
            }
        }

        // --- ROGUE-LITE ENGINE ---

        function initQuest() {
            isGameMode = true;
            promptPrefix.innerHTML = "IAN@STAIRS:~$&nbsp;";
            log.innerHTML = "";
            addLog("!! INITIALIZING SUB-RENDER: THE STAIRS !!", "var(--term-amber)");
            addLog("The closet door thuds shut. You are standing on a stone landing.");
            addLog("One path leads UP into the Light. One leads DOWN into the Roots.");
            addLog("Type 'UP' or 'DOWN' to begin your descent into meaning.");
            renderStats();
        }

        function renderStats() {
            addLog(`[ HP: ${player.hp}/${player.maxHp} | MEANING: ${player.meaning} | DEPTH: ${player.depth} ]`, "var(--term-amber)");
        }

        function handleGameCommand(cmd) {
            if (cmd === 'exit' || cmd === 'quit') {
                isGameMode = false;
                promptPrefix.innerHTML = "TANDEM@ROOT:~$&nbsp;";
                addLog("Exiting Sub-render. Reality collapsing back to terminal...");
                return;
            }

            if (cmd === 'up' || cmd === 'down') {
                player.depth += (cmd === 'up' ? -1 : 1);
                generateEncounter();
            } else if (cmd === 'rest') {
                if (player.meaning >= 2) {
                    player.meaning -= 2;
                    player.hp = player.maxHp;
                    addLog("You focus on the 'Knot'. Your physical form stabilizes. HP restored.");
                } else {
                    addLog("Not enough Meaning to anchor a rest.");
                }
            } else {
                addLog("Invalid movement. The Stairs only go UP or DOWN. (Or 'REST' / 'QUIT')");
            }
            renderStats();
        }

        function generateEncounter() {
            const roll = Math.random();
            if (roll < 0.3) {
                addLog("A quiet landing. You find a discarded Aethel Rune.");
                player.meaning += 1;
            } else if (roll < 0.7) {
                const enemy = ENEMIES[Math.min(ENEMIES.length - 1, Math.floor(player.depth / 3))];
                addLog(`DANGER: A ${enemy.name.toUpperCase()} emerges from the static!`, "red");
               
                // Simplified Combat Loop
                const playerDmg = 3 + Math.floor(player.meaning / 2);
                addLog(`You strike for ${playerDmg} damage.`);
                if (enemy.hp > playerDmg) {
                    addLog(`The ${enemy.name} counters! You take ${enemy.dmg} damage.`, "red");
                    player.hp -= enemy.dmg;
                } else {
                    addLog(`You deleted the ${enemy.name}. +${enemy.xp} Meaning.`);
                    player.meaning += enemy.xp;
                }
            } else {
                addLog("The hallway stretches into infinity. Nothing but the smell of ozone.");
            }

            if (player.hp <= 0) {
                addLog("!! FATAL ERROR: CAUSALITY DISRUPTED !!", "red");
                addLog("You have become a memory. Returning to Root...");
                isGameMode = false;
                player = { hp: 20, maxHp: 20, meaning: 5, level: 1, depth: 0 };
                setTimeout(() => {
                    promptPrefix.innerHTML = "TANDEM@ROOT:~$&nbsp;";
                    handleTerminalCommand('clear');
                }, 2000);
            }
        }

        function triggerCrayola() {
            body.classList.add('deprecation-mode');
            addLog("!! ERROR !! RENDER REPLACED BY CONSTRUCTION PAPER.", "black");
            setTimeout(() => body.classList.remove('deprecation-mode'), 4000);
        }

        // Background Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('time-display').innerText = `T+${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}`;
        }, 1000);

    </script>
</body>
</html>

